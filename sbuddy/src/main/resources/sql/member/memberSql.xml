<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sbuddy.web.member.MemberMapper">
	<select id="loginMember" resultType="HashMap">
		SELECT
			idx as idx_member
			, tmp_password_yn
		FROM
			MEMBER
		WHERE
			id = #{id}
		AND password = #{hashPassword}
	</select>
	
	<!-- ##### 회원가입 ##### -->
	
	<!-- 아이디(이메일) 중복체크 -->
	<select id="duplicateMember" parameterType="HashMap" resultType="int">
		SELECT
			COUNT(*)
		FROM
			MEMBER
		WHERE
			id = #{email}
	</select>
	
	
	<!-- 회원가입시 회원 등록 -->
	<insert id="joinMember" parameterType="HashMap" useGeneratedKeys="true" keyProperty="idx">
		INSERT INTO MEMBER (
			id
			, password
			, username
			, email
		) VALUES (
			#{id}
			, #{hashPassword}
			, #{username}
			, #{email}
		)
	</insert>
	
	
	<!-- 회원 정보 가져오기 -->
	<select id="getMemberInfo" parameterType="HashMap">
		SELECT
			  idx AS idx_member
			, id
			, username
			, email
			, insert_date
			, profile
		FROM
			MEMBER
		<where>
			<if test="id != null and id !=''">
					id = #{id}
			</if>
			<if test="email != null and email !=''">
				AND email = #{email}
			</if>
		</where>
	</select>
	
	
	<!-- 임시 비밀번호 변경 -->
	<update id="changePassword" parameterType="HashMap">
		UPDATE MEMBER
		SET   password = #{new_password}
			, tmp_password_yn = 'Y'
		WHERE
			idx = #{idx_member}
	</update>
	
	<!-- 첫 로그인 시 키워드가 등록되어있는지 검사 -->
	<select id="getMemberKeywordCount" parameterType="HashMap" resultType="int">
		SELECT
			COUNT(*)
		FROM
			MEMBER_KEYWORD
		WHERE
			idx_member = #{idx_login}
	</select>

	<!-- 회원 키워드 등록 -->
	<insert id="insertMemberKeyword" parameterType="HashMap">
		INSERT INTO MEMBER_KEYWORD (
			idx_member
			, idx_keyword
		) VALUES (
			#{idx_login}
			, #{idx_keyword}
		)
	</insert>
	

</mapper>